## 三次握手与四次挥手原理

第一次握手：建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；

（SYN：同步序列编号）

第二次握手：服务器收到syn包，必须确认客户的syn（ack=j+1），同时自己也发送一个syn包（syn=k），即syn+ack包，此时服务器进入SYN_RECV状态；

第三次握手：客户端收到服务器的syn+ack包，向服务器发送确认包，向服务器发送确认包ack包（ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。

完成三次握手，客户端与服务器开始传送数据，在上述过程中，还有一些重要的概念：

未连接队列：

在三次握手协议中，服务器维护一个未连接队列，该队列为每个客户端的SYN包（syn=j）开设一个条目，该条目表明该服务器已收到syn包，并向客户端发出确认，正在等待客户的确认包。这些条目所标识的连接在服务器处于SYN_RECV状态，当服务器收到客户的确认包时，删除该条目，服务器进入ESTABLISHED状态。



关闭TCP连接：改进的三次握手：四次挥手

对于一个已经建立的连接，TCP使用改进的三次握手来释放连接（使用一个带有FIN附加标记的报文段）。

第一步：当主机A的应用程序通知TCP数据已经发送完毕时，TCP向主机B发送一个带有FINB附加标记的报文段（FIN代表finsh）

第二步：当主机收到FIN这个报文段之后，并不立即用FIN报文段回复主机A，而是先向主机A发送一个确认序号ack，同时通知

笔记